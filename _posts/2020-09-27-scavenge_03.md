---
layout: post
title:  "Cosmos-SDK Scavenge 03"
author: violetstair
categories: [ CosmosSDK ]
tags: [Golang, Programming]
image: assets/images/cosmos-sdk.png
description: "COSMOS SDK로 만들어보는 현상금 사냥꾼 게임"
featured: false
hidden: true
---

## Messages

Messages는 어플리케이션이 동작하는 기능을 정의하기 때문에 모듈을 개발할 때 시작하기 좋은 위치입니다.
사용자가 어떤 방식으로 어플리케이션의 상태를 업데이트 할 수 있는 모든 시나리오를 생각해야 합니다.
이것들은 **CRUD** (Create, Read, Update, Delete)와 같은 기본적인 상호 작용으로 요약되어야합니다.

Let's start with **Create**

### MsgCreateScavenge

Messages는 `./x/scavenge/types/` 디렉토리에 있는 `types` 입니다.
이미 `msg.go` 파일이 있지만 각 메시지 유형별로 새파일을 만들 것입니다.
`msg.go`를 다음과 같이 `MsgCreateScavenge.go`로 이름을 변경하여 사용할 수 있습니다.

```bash
mv ./x/scavenge/types/msg.go  ./x/scavenge/types/MsgCreateScavenge.go
```

이 새파일을 다음과 같이 수정합니다.

[MsgCreateScavenge](https://github.com/cosmos/sdk-tutorials/tree/master/scavenge/x/scavenge/types/MsgCreateScavenge.go)

메시지 `struct`에는 새로운 `scavenge`를 만들 때 필요한 모든 정보가 포함됩니다

- `Creator` - 누가 만들었는지에 대한 정보, 공개 키 암호로 제어되는 앱의 계정을 나타내는 `sdk.AccAddress` type
- `Description` - 해결해야 할 문제 또는 도전에 설명
- `SolutionHash` - 문제에 대한 정답
- `Reward` - 답변을 먼저 제출한 사람에게 수여되는 현상금

또한 앱의 모든 Messages는 `sdk.Msg` 인터페이스를 따라야 하며 `Route`, `Type`, `GetSigners`, `GetSignBytes`, `ValidateBasic` 와 같은 메소드 들을 작성합니다.

이제 새로운 현상금이 걸린 문제를 등록할 수 있습니다. 이번엔 문제를 해결하는 Messages를 작성할 차례입니다.
앞서 설명한대로 `MsgCommitSolution`와는 다른 `MsgRevealSolution`에 별도로 작성합니다.

### MsgCommitSolution

message type을 `./x/scavenge/types/MsgCommitSolution.go` 파일에 다음과 같이 정의합니다.

[MsgCommitSolution](https://github.com/cosmos/sdk-tutorials/tree/master/scavenge/x/scavenge/types/MsgCommitSolution.go)

Message는 다음과 같은 `struct` 정보를 포함합니다.

- `Scavenger` - 정답을 제출한 사용자의 address
- `SolutionHash` - 제출한 정답의 hash
- `SolutionScavengerHash` - 정답을 제출한 사용자의 정보와 정답을 합친 값의 hash

앞서 설명한대로 `sdk.Msg` 인터페이스를 따라야 합니다.

### MsgRevealSolution

마지막으로 `./x/scavenge/types/MsgRevealSolution.go` 파일도 다음과 같이 정의 합니다.

[MsgRevealSolution](https://github.com/cosmos/sdk-tutorials/tree/master/scavenge/x/scavenge/types/MsgRevealSolution.go)

Message는 다음과 같은 `struct` 정보를 포함합니다.

- `Scavenger` - 정답을 제출한 사용자 정보
- `SolutionHash` - 제출한 정답의 hash
- `Solution` - 제출한 정답의 평문 데이터

앞서 설명한대로 `sdk.Msg` 인터페이스를 따라야 합니다.

### Codec

지금까지 messages에 대한 정의를 했습니다.
messages는 bytes로 인코딩되어 저장됩니다.
이제 messages를 bytes로 인코딩 되는 방법을 정해야 됩니다.
`./x/scavenge/types/codec.go`에 다음과 같이 인코딩 유형을 작성하면 인코딩 라이브러리와 함께 동작합니다.

[codec](https://github.com/cosmos/sdk-tutorials/tree/master/scavenge/x/scavenge/types/codec.go)

### Alias

지금가지 작성한 새로운 messages type을 모듈의 다른 부분에서 접근할 수 있도록 `./x/scavenge/alias.go`파일에 지정해 주어야 합니다.
이렇게 하면 중첩된 `types`를 디렉토리에서 가져와 모듈 최상위 디렉토리에서도 액세스할 수 있습니다.

[alias](https://github.com/cosmos/sdk-tutorials/tree/master/scavenge/x/scavenge/alias.go)

Messages를 만들었지만 이 정보를 어딘가에 저장해야 합니다. 이와 관련된 기능은 `Keeper`에 있어야 합니다.

다음으로 Scavenge Module의 `Keeper`를 만들어볼 차례입니다.
